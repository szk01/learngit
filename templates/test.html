<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>来电通知</title>
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.bootcss.com/socket.io/1.5.1/socket.io.min.js"></script>
    <style type="text/css">
        * {
            margin: 0;
        }
        #phone-note {
            margin: 10px 5px;                 /* 上下 左右 */
            height: 60px;
            /*border: 1px solid #000;*/
            background-color: #EEE9E9;

        }

        ul li {
            list-style: none;
            float: left;
            margin: 20px 10px;
            width: 200px;
        }
        .cdr {
            font-weight: bold;
        }
        .number {
            /*width: 200px;*/
            /*border: 1px solid #000;*/

        }
        .status {
            /*width: 200px;*/
            /*border: 1px solid #000;*/
        }
        .time {
            /*width: 200px;*/
            /*border: 1px solid #000;*/
        }
        .bt {
            font-size: 15px;
            cursor: pointer;
            background-color: #008CBA;     /* 蓝色*/
            color: white;                  /* 文字颜色*/
        }
    </style>
</head>
<body>
    <h2>使用webSocket协议</h2>

    <ul id="phone-note">
        <li class="cdr">通话记录</li>
        <li class="number"><em>来电号码</em></li>
        <li class="status">呼叫中...</li>
        <li class="time">呼叫时长</li>
        <li>
            <button class="bt">关闭</button>
        </li>
    </ul>

<script type="text/javascript">
    $(function() {
        var url = "http://106.15.44.224:80";
        console.log(url);
        var socket = io.connect(url);
        socket.on('connect', function() {
            socket.emit('login', {data: 'client send message sucessfully!'});
        });                                                          // 这些都是套路函数，建立通道，发送提示消息

        socket.on("number", function(data) {                         // 接收来电号码消息
            alert(data+'来电');
            $('.number').text('来电号码'+data)
            $('#phone-note').show();
        });

        socket.on("idle", function(data) {                          // 分机忙碌转空闲，显示通话状态
            if (data === 'phone idle') {
                $('.num-text').text('通话已关闭');
            }
            if (data === 'answer') {
                $('.status').text('呼叫已应答')
            }
        });

        // 点击关闭显示框
        $(".bt").click(function(){
            $('#phone-note').hide();
        });
    });
</script>
</body>
</html>